<html>
<head>
<base href="https://cdn.jsdelivr.net/gh/Pok12d/ta@main/sma/">
<script src="jszip.js"></script>
</head>
<body>
<h1 id="loadingg">Loading...</h1>
<script>
  async function fetchAndCombineZip(binUrls) {
    const responses = await Promise.all(binUrls.map(url => fetch(url)));
    const buffers = await Promise.all(responses.map(res => res.arrayBuffer()));
    let totalLength = buffers.reduce((acc, buf) => acc + buf.byteLength, 0);
    let combined = new Uint8Array(totalLength);
    let offset = 0;
    for (let buf of buffers) {
        combined.set(new Uint8Array(buf), offset);
        offset += buf.byteLength;
    }
    return combined;
}

async function unzipWebpFromExternalBins(binUrls) {
    const blobUrls = {};
    const bytes = await fetchAndCombineZip(binUrls);
    const zip = await JSZip.loadAsync(bytes);
    for (const [filename, file] of Object.entries(zip.files)) {
        if (!file.dir) {
            let mime = '';
            if (filename.endsWith('.js') || filename.endsWith('.mjs')) {
                mime = 'text/javascript';
            } else if (filename.endsWith('.css')) {
                mime = 'text/css';
            } else if (filename.endsWith('.html')) {
                mime = 'text/html';
            } else if (filename.includes('250100c98afece1d27bb09b3a3d618ca')) {
                mime = 'application/wasm';
            } 
            else if (filename.includes('ed690d1402dd39fcf7abb15b99effdea')) {
                mime = 'application/javascript';
            }
            else if (filename.endsWith('.png')) {
                mime = 'image/png';
            } else if (filename.endsWith('.jpg') || filename.endsWith('.jpeg')) {
                mime = 'image/jpeg';
            }
			else if (filename.endsWith('.wasm') ) {
                mime = 'application/wasm';
            }
            else if (filename.endsWith('.data.unityweb')) {
                mime = 'application/octet-stream';
            } else if (filename.endsWith('.asm.code.unityweb')) {
                mime = 'application/javascript';
            } else if (filename.endsWith('.asm.memory.unityweb')) {
                mime = 'application/octet-stream';
            } else if (filename.endsWith('.asm.framework.unityweb')) {
                mime = 'application/javascript';
            } else if (filename.endsWith('.wasm')) {
                mime = 'application/wasm';
            }

            if (filename.endsWith('.asm.framework.unityweb')) mime = 'application/javascript';
            if (filename.endsWith('.asm.code.unityweb')) mime = 'application/javascript';
            if (filename.endsWith('.asm.memory.unityweb')) mime = 'application/octet-stream';

            const rawBlob = await file.async("blob");
            const blob = mime ? new Blob([rawBlob], { type: mime }) : rawBlob;
            const blobUrl = URL.createObjectURL(blob);
            blobUrls[filename] = blobUrl;
        }
    }
    return blobUrls;
}

let blobUrlss = "";
let binParts = [
  "part_1.bin",
  "part_2.bin",
];

unzipWebpFromExternalBins(binParts).then(blobUrls => {
	document.getElementById("loadingg").remove();
    blobUrlss = blobUrls;
    const ORIGINAL_CREATE_ELEMENT = document.createElement;
    const ORIGINAL_SET_ATTRIBUTE = Element.prototype.setAttribute;

    document.createElement = function(tagName) {
        const el = ORIGINAL_CREATE_ELEMENT.call(this, tagName);
        if (tagName.toLowerCase() === 'script') {
            Object.defineProperty(el, 'src', {
                set(newSrc) {
                    const filename = extractFilename(newSrc);
                    const replacement = blobUrlss[filename];
                    if (replacement) {
                        ORIGINAL_SET_ATTRIBUTE.call(el, 'src', replacement);
                    } else {
                        ORIGINAL_SET_ATTRIBUTE.call(el, 'src', newSrc);
                    }
                },
                get() {
                    return el.getAttribute('src');
                },
                configurable: true
            });
        }
        return el;
    };

    Element.prototype.setAttribute = function(name, value) {
        if (this.tagName === 'SCRIPT' && name === 'src') {
            const filename = extractFilename(value);
            const replacement = blobUrlss[filename];
            if (replacement) {
                return ORIGINAL_SET_ATTRIBUTE.call(this, name, replacement);
            }
        }
        return ORIGINAL_SET_ATTRIBUTE.call(this, name, value);
    };

    function extractFilename(url) {
        try {
            return new URL(url, location.href).pathname.split('/').pop();
        } catch {
            return url.split('/').pop(); 
        }
    }

    const imageSrcDescriptor = Object.getOwnPropertyDescriptor(Image.prototype, 'src');
    Object.defineProperty(Image.prototype, 'src', {
      set(value) {
        const newURL = rewriteURL(value);
        imageSrcDescriptor.set.call(this, newURL);
      },
      get: imageSrcDescriptor.get,
      configurable: true,
      enumerable: true,
    });

    const scriptSrcDescriptor = Object.getOwnPropertyDescriptor(HTMLScriptElement.prototype, 'src');
    Object.defineProperty(HTMLScriptElement.prototype, 'src', {
      set(value) {
        const newURL = rewriteURL(value);
        scriptSrcDescriptor.set.call(this, newURL);
      },
      get: scriptSrcDescriptor.get,
      configurable: true,
      enumerable: true,
    });

    const linkHrefDescriptor = Object.getOwnPropertyDescriptor(HTMLLinkElement.prototype, 'href');
    Object.defineProperty(HTMLLinkElement.prototype, 'href', {
      set(value) {
        const newURL = rewriteURL(value);
        linkHrefDescriptor.set.call(this, newURL);
      },
      get: linkHrefDescriptor.get,
      configurable: true,
      enumerable: true,
    });

    const mediaSrcDescriptor = Object.getOwnPropertyDescriptor(HTMLMediaElement.prototype, 'src');
    Object.defineProperty(HTMLMediaElement.prototype, 'src', {
      set(value) {
        const newURL = rewriteURL(value);
        mediaSrcDescriptor.set.call(this, newURL);
      },
      get: mediaSrcDescriptor.get,
      configurable: true,
      enumerable: true,
    });

    const originalFetch = window.fetch;
    window.fetch = function(resource, init) {
      if (typeof resource === "string") {
        resource = rewriteURL(resource);
      } else if (resource instanceof Request) {
        resource = new Request(rewriteURL(resource.url), resource);
      }
      return originalFetch.call(this, resource, init);
    };

    const originalOpen = XMLHttpRequest.prototype.open;
    XMLHttpRequest.prototype.open = function(method, url, ...rest) {
      const newURL = rewriteURL(url);
      return originalOpen.call(this, method, newURL, ...rest);
    };

    const OriginalAudio = window.Audio;
    window.Audio = function(src) {
      const audio = new OriginalAudio();
      if (src) {
        audio.src = rewriteURL(src);
      }
      return audio;
    };
    window.Audio.prototype = OriginalAudio.prototype;

    function rewriteURL(original) {
        if (original.includes("prod/") && original.includes("common-v") ) return "https://cdn.jsdelivr.net/gh/Pok12d/ta@main/sma/gamesettings/prod/360/common-v4.json";
        else if (original.startsWith("https://smashkarts.io")) return "https://cdn.jsdelivr.net/gh/Pok12d/ta@main/sma" + original.split("https://smashkarts.io")[1]
        else if (original.startsWith("https://smashkartsgc.b-cdn.net")) return  "https://cdn.jsdelivr.net/gh/Pok12d/ta@main/sma" + original.split("https://smashkartsgc.b-cdn.net")[1]
        var trimmed = original.split("/").pop();
        if (trimmed.includes("?")) trimmed = trimmed.split("?")[0]
        return blobUrlss[trimmed] || original;
    }

    document.open()
    document.write("<!DOCTYPE html>\r\n<html lang=\"en-us\">\r\n\r\n<head>\r\n<base href = \"https:\/\/cdn.jsdelivr.net\/gh\/Pok12d\/ta@main\/sma\/\">\r\n\t<script src=\"scripts\/constants.js\"><\/script>\r\n\t\r\n\t\r\n\t<meta charset=\"utf-8\">\r\n\t<link rel=\"icon\" href=\"images\/favicon.png\" sizes=\"16x16\">\r\n\t<meta property=\"og:site_name\" content=\"SmashKarts.io\">\r\n\t<meta property=\"og:title\" content=\"rr\" \/>\r\n\t<meta property=\"og:url\" content=\"https:\/\/smashkarts.io\/\" \/>\r\n\t<meta property=\"og:type\" content=\"website\" \/>\r\n\t<meta property=\"og:description\"\r\n\t\t  content=\"School is a free  Multiplayer  Battle Arena game. Drive fast. Fire rockets. Make big explosions.\" \/>\r\n\t<meta property=\"og:image\" content=\"images\/icon-144.png\" \/>\r\n\t<meta property=\"og:image:width\" content=\"144\" \/>\r\n\t<meta property=\"og:image:height\" content=\"144\" \/>\r\n\t<meta itemprop=\"name\" content=\"ee\" \/>\r\n\t<meta itemprop=\"url\" content=\"https:\/\/smashkarts.io\/\" \/>\r\n\t<meta itemprop=\"description\"\r\n\t\t  content=\" Arena . Drive fast. Fire rockets. Make big explosions.\" \/>\r\n\t<meta itemprop=\"thumbnailUrl\" content=\"https:\/\/smashkarts.io\/\" \/>\r\n\t<link rel=\"image_src\" href=\"https:\/\/smashkarts.io\/\" \/>\r\n\t<meta itemprop=\"image\" content=\"https:\/\/smashkarts.io\/\" \/>\r\n\t<meta name=\"twitter:title\" content=\"ee\" \/>\r\n\t<meta name=\"twitter:image\" content=\"images\/icon-144.png\" \/>\r\n\t<meta name=\"twitter:url\" content=\"https:\/\/smashkarts.io\/\" \/>\r\n\t<meta name=\"twitter:card\" content=\"summary_large_image\" \/>\r\n\t<meta name=\"twitter:description\"\r\n\t\t  content=\" is a free  Multiplayer Kart Battle Arena . Drive fast. Fire rockets. Make big explosions.\" \/>\r\n\t<meta name=\"description\"\r\n\t\t  content=\" Multiplayer Kart   . Drive fast. Fire rockets. Make big explosions.\" \/>\r\n\t<meta name=\"google-site-verification\" content=\"Kb9JniKgGSfuiJM_DNO2-Va7cSC00GlcBzbDw1Lgw_4\" \/>\r\n\t<meta itemprop=\"image primaryImageOfPage\" content=\"images\/smashkarts.png\" \/>\r\n\r\n\t<link rel=\"manifest\" href=\"manifest.json\">\r\n\r\n\t<meta name=\"apple-mobile-web-app-title\" content=\"ee\">\r\n\t<meta name=\"apple-mobile-web-app-capable\" content=\"yes\">\r\n\t<meta name=\"apple-mobile-web-app-status-bar-style\" content=\"black-translucent\">\r\n\t<link rel=\"apple-touch-icon\" href=\"images\/icon-144.png\">\r\n\r\n\t<script type=\"application\/ld+json\">\r\n\t\t{\r\n\t\t\t\"@context\": \"http:\/\/schema.org\",\r\n\t\t\t\"@type\":\"VideoGame\",\r\n\t\t\t\"publisher\": \"Tall Team\",\r\n\t\t\t\"name\":[\r\n\t\t\t\t{\r\n\t\t\t\t\t\"@language\":\"en\",\r\n\t\t\t\t\t\"@value\":\"ee\"\r\n\t\t\t\t}\r\n\t\t\t],\r\n\t\t\t\"description\":[\r\n\t\t\t\t{\r\n\t\t\t\t\t\"@language\":\"en\",\r\n\t\t\t\t\t\"@value\":\" is a free   Kart  Arena . Drive fast. Fire rockets. Make big explosions.\"\r\n\t\t\t\t}\r\n\t\t\t],\r\n\t\t\t\"applicationCategory\":[\r\n\t\t\t\t\"Game\"\r\n\t\t\t],\r\n\t\t\t\"operatingSystem\":[\r\n\t\t\t\t\"WEB\"\r\n\t\t\t],\r\n\t\t\t\"genre\":[\r\n\t\t\t\t\"Car Battle\",\r\n\t\t\t\t\"Shooter\",\r\n\t\t\t\t\"Multiplayer\"\r\n\t\t\t],\r\n\t\t\t\"url\":\"https:\/\/smashkarts.io\/\",\r\n\t\t\t\"image\":\"images\/SmashKartsPoster.jpg\",\r\n\t\t\t\"screenshot\":\"images\/SmashKartsBackground.jpg\"\r\n\t\t}\r\n\t<\/script>\r\n\t<title>Smash Karts<\/title>\r\n\t<link rel=\"stylesheet\" href=\"css\/main.css\" \/>\r\n\t<meta name=\"viewport\" content=\"minimal-ui, user-scalable=no, initial-scale=1, maximum-scale=1, width=device-width, viewport-fit=cover\" \/>\r\n\r\n\t<script src=\"scripts\/ads-init.js\"><\/script>\t\r\n<\/head>\r\n\r\n<body>\r\n<div id=\"mainContainer\">\r\n\t<div id=\"gameContainer\">\r\n\t\t<div id=\"gameCanvasWrapper\">\r\n\t\t\t<canvas id=\"gameCanvas\"><\/canvas>\r\n\t\t<\/div>\r\n\t<\/div>\r\n\t<div id=\"loader\">\r\n\t\t<img class=\"logo\" src=\"images\/smashkarts.png\">\r\n\t\t<div class=\"spinner\"><\/div>\r\n\t\t<div class=\"progress\">\r\n\t\t\t<div class=\"full\"><\/div>\r\n\t\t<\/div>\r\n\t<\/div>\r\n\t<div id=\"rotate-landscape\">\r\n\t\t<img src=\"images\/r.png\" class=\"center\">\r\n\t<\/div>\r\n\r\n\t<script src=\"https:\/\/www.gstatic.com\/firebasejs\/9.9.3\/firebase-app-compat.js\"><\/script>\r\n\t<script src=\"https:\/\/www.gstatic.com\/firebasejs\/9.9.3\/firebase-auth-compat.js\"><\/script>\r\n\t<script src=\"https:\/\/www.gstatic.com\/firebasejs\/9.9.3\/firebase-database-compat.js\"><\/script>\r\n\t<script src=\"https:\/\/www.gstatic.com\/firebasejs\/9.9.3\/firebase-analytics-compat.js\"><\/script>\r\n\t<script src=\"https:\/\/www.gstatic.com\/firebasejs\/9.9.3\/firebase-functions-compat.js\"><\/script>\r\n\r\n\t<script src=\"scripts\/main.js\"><\/script>\r\n\t<script src=\"scripts\/auth.js\"><\/script>\r\n\t<script src=\"scripts\/shop.js\"><\/script>\r\n\t<script src=\"scripts\/cc.js\"><\/script>\r\n\r\n\t<script src=\"scripts\/ads-common-logic.js\"><\/script>\r\n\t<script src=\"scripts\/ads-positioning-logic.js\"><\/script>\r\n\t<script src=\"scripts\/ads-injector.js\"><\/script>\r\n\r\n\t<script>\r\n\t\tif ('serviceWorker' in navigator)\r\n\t\t{\r\n\t\t\tnavigator.serviceWorker.register('service-worker2.js');\r\n\t\t}\r\n\r\n\t\tconst firebaseConfig = {\r\n\t\t\tapiKey: \"AIzaSyAdY2qq9083amKDS0R8tn2tjIKQB8mocco\",\r\n\t\t\tauthDomain: \"webgltest-17af1.firebaseapp.com\",\r\n\t\t\tdatabaseURL: \"https:\/\/webgltest-17af1.firebaseio.com\",\r\n\t\t\tprojectId: \"webgltest-17af1\",\r\n\t\t\tmessagingSenderId: \"480659433590\",\r\n\t\t\tappId: \"1:480659433590:web:a01ad1599e963843a0d757\",\r\n\t\t\tmeasurementId: \"G-1W23DRFHK9\"\r\n\t\t};\r\n\r\n\t\tfirebase.initializeApp(firebaseConfig);\r\n\t\tanalytics = firebase.analytics();\r\n\t\tgtag('config', 'G-1W23DRFHK9', {'cookie_flags': 'samesite=none;secure'}); \r\n\t\t\r\n\t\tvar timerStart = Date.now();\r\n\t\tvar dataFile = \"\/cde9b7051535319df292526442914c36.data.br\";\r\n\t\tvar mobileDataFile = \"\/cde9b7051535319df292526442914c36.data.br\";\r\n\t\t\r\n\t\tif(!mobileDataFile.includes(\"MOBILE_DATA_FILENAME\"))\r\n\t\t{\r\n\t\t\tvar c = document.createElement(\"canvas\");\r\n\t\t\tvar gl = c.getContext(\"webgl\");\r\n\t\t\tvar gl2 = c.getContext(\"webgl2\");\r\n\t\t\tif ((gl && gl.getExtension('WEBGL_compressed_texture_astc')) || (gl2 && gl2.getExtension('WEBGL_compressed_texture_astc'))) \r\n\t\t\t{\r\n\t\t\t\tdataFile = mobileDataFile;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconst buildUrl = \"Build\";\r\n\t\tconst loaderUrl = buildUrl + \"\/76f034cff49013ce85bd6945ebf32347.loader.js\";\r\n\t\tconst config = {\r\n\t\t\tdataUrl: buildUrl + dataFile,\r\n\t\t\tframeworkUrl: buildUrl + \"\/ed690d1402dd39fcf7abb15b99effdea.framework.js.br\",\r\n\t\t\tcodeUrl: buildUrl + \"\/250100c98afece1d27bb09b3a3d618ca.wasm.br\",\r\n\t\t\tstreamingAssetsUrl: \"StreamingAssets\",\r\n\t\t\tcompanyName: \"TallTeam\",\r\n\t\t\tproductName: \"rr\",\r\n\t\t\tproductVersion: \"2.9.0\",\r\n\t\t};\r\n\r\n\t\tvar canvas = document.querySelector(\"#gameCanvas\");\r\n\t\tvar loadingBar = document.querySelector(\"#loader\");\r\n\t\tvar progressBarFull = document.querySelector(\"#loader .progress .full\");\r\n\t\t\r\n\t\tvar script = document.createElement(\"script\");\r\n\t\tscript.src = loaderUrl;\r\n\r\n\t\tvar progressCreateUnityInstance = 0;\r\n\t\tvar progressPostCreateUnityInstance = 0;\r\n\t\tvar updateProgressInterval = setInterval(updateProgress, 100);\r\n\r\n\t\tscript.onload = () =>\r\n\t\t{\r\n\t\t\tcreateUnityInstance(canvas, config, (progress) =>\r\n\t\t\t{\r\n\t\t\t\tprogressCreateUnityInstance = 100 * progress;\r\n\t\t\t\tsetProgressWidth();\r\n\t\t\t}).then((unityInstance) =>\r\n\t\t\t{\r\n\t\t\t\tloadingBar.style.display = \"none\";\r\n\t\t\t\twindow.unityGame = unityInstance;\r\n\t\t\t\tif (updateProgressInterval) clearInterval(updateProgressInterval);\r\n\t\t\t}).catch((message) =>\r\n\t\t\t{\r\n\t\t\t\talert(\"TT UnityLoader Error\" + message);\r\n\t\t\t});\r\n\t\t};\r\n\t\tdocument.body.appendChild(script);\r\n\r\n\t\tfunction updateProgress()\r\n\t\t{\r\n\t\t\tif (progressCreateUnityInstance > 85)\r\n\t\t\t{\r\n\t\t\t\tprogressPostCreateUnityInstance += 1;\r\n\t\t\t\tsetProgressWidth();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction setProgressWidth()\r\n\t\t{\r\n\t\t\tif (progressCreateUnityInstance == 100.0)\r\n\t\t\t{\r\n\t\t\t\tprogressBarFull.style.width = \"100%\";\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tvar percent = progressCreateUnityInstance * 0.9 + progressPostCreateUnityInstance * 0.1;\r\n\t\t\t\tpercent = Math.min(percent, 95);\r\n\t\t\t\tprogressBarFull.style.width = percent + \"%\";\r\n\t\t\t}\r\n\t\t}\r\n\t<\/script>\r\n<\/body>\r\n<\/html>");
    document.close()
});
</script>
</body>
</html>
